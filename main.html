<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PhotoBooth SCpES</title>
    <script
        src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
        integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
        crossorigin="anonymous"
    ></script>
    <script
        src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js"
        integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy"
        crossorigin="anonymous"
    ></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link id="theme-link" rel="stylesheet" href="style.css">

    <style>
        #backButton {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(50, 50, 50, 0.9);
            backdrop-filter: blur(10px);
            color: #f0f0f0;
            border: none;
            width: 44px;
            height: 44px;
            border-radius: 22px;
            cursor: pointer;
            font-size: 18px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            opacity: 0.6;
        }

        #backButton:hover {
            background: rgba(70, 70, 70, 1);
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.4);
            opacity: 1;
        }

        #backButton:active {
            transform: translateY(0);
        }

        .format-indicator {
            backdrop-filter: blur(10px);
            color: white !important;
            padding: 8px 16px !important;
            border-radius: 20px;
            font-size: 12px !important;
            font-weight: 600 !important;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            transition: all 0.3s ease;
            display: inline-block !important;
            margin-left: 15px;
            vertical-align: middle;
            min-width: 120px;
            text-align: center !important;
            white-space: nowrap;
            visibility: visible !important;
            opacity: 1 !important;
            line-height: 1.2 !important;
            position: relative;
            overflow: hidden;
            background-size: 300% 300% !important;
        }

        .format-indicator.classic {
            background: linear-gradient(45deg, #ff6b6b, #ff8e7f, #ffa726, #ff7043, #e57373, #ff6b6b) !important;
            background-size: 300% 300% !important;
            box-shadow: 0 4px 12px rgba(255, 107, 107, 0.4);
            animation: classicGradientShift 4s ease-in-out infinite;
        }

        .format-indicator.stories {
            background: linear-gradient(45deg, #667eea, #764ba2, #667eea, #a8edea, #667eea, #f093fb) !important;
            background-size: 300% 300% !important;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
            animation: storiesGradientShift 4s ease-in-out infinite;
        }

        .format-indicator.enhanced {
            background: linear-gradient(45deg, #11998e, #38ef7d, #06ffa5, #11998e, #00d4ff, #38ef7d) !important;
            background-size: 300% 300% !important;
            box-shadow: 0 4px 12px rgba(17, 153, 142, 0.4);
            animation: enhancedGradientShift 4s ease-in-out infinite;
        }

        @keyframes classicGradientShift {
            0%, 100% {
                background-position: 0% 50%;
            }
            25% {
                background-position: 100% 0%;
            }
            50% {
                background-position: 100% 100%;
            }
            75% {
                background-position: 0% 100%;
            }
        }

        @keyframes storiesGradientShift {
            0%, 100% {
                background-position: 0% 50%;
            }
            33% {
                background-position: 100% 0%;
            }
            66% {
                background-position: 100% 100%;
            }
        }

        @keyframes enhancedGradientShift {
            0%, 100% {
                background-position: 0% 50%;
            }
            25% {
                background-position: 100% 25%;
            }
            50% {
                background-position: 50% 100%;
            }
            75% {
                background-position: 0% 75%;
            }
        }

        .format-indicator:hover {
            transform: translateY(-2px) scale(1.05);
            animation-duration: 2s !important;
        }

        .format-indicator.classic:hover {
            box-shadow: 0 8px 20px rgba(255, 107, 107, 0.6);
        }

        .format-indicator.stories:hover {
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.6);
        }

        .format-indicator.enhanced:hover {
            box-shadow: 0 8px 20px rgba(17, 153, 142, 0.6);
        }

        /* Dark mode styling for main page elements */
        .title {
            color: #f0f0f0 !important;
        }

        .container {
            color: #f0f0f0;
        }

        .btn {
            background: rgba(50, 50, 50, 0.9) !important;
            backdrop-filter: blur(10px);
            color: #f0f0f0 !important;
            border: 1px solid rgba(255, 255, 255, 0.1) !important;
            transition: all 0.3s ease;
        }

        .btn:hover {
            background: rgba(70, 70, 70, 1) !important;
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.4);
            color: #ffffff !important;
        }

        .btn-start {
            background: linear-gradient(45deg, #1a3de6, #40e0d0, #667eea, #ff6b9d, #1a3de6) !important;
            background-size: 300% 300% !important;
            border: 2px solid #667eea !important;
            animation: gradientShift 4s ease infinite !important;
            position: relative !important;
            overflow: hidden !important;
        }

        @keyframes gradientShift {
            0% {
                background-position: 0% 50%;
            }
            25% {
                background-position: 100% 50%;
            }
            50% {
                background-position: 100% 100%;
            }
            75% {
                background-position: 0% 100%;
            }
            100% {
                background-position: 0% 50%;
            }
        }

        .btn-start.capturing {
            background: #6c757d !important;
            color: white !important;
            cursor: default !important;
            animation: none !important;
            transform: none !important;
            box-shadow: none !important;
            border: none !important;
        }

        .btn-start.capturing:hover {
            background: #6c757d !important;
            color: white !important;
            cursor: default !important;
            animation: none !important;
            transform: none !important;
            box-shadow: none !important;
            border: none !important;
        }

        .btn-start:not(.capturing):hover {
            background: linear-gradient(45deg, #0f2db8, #2bc9ba, #4a5dd9, #e95aa0, #0f2db8) !important;
            background-size: 300% 300% !important;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.6) !important;
            animation: gradientShift 2s ease infinite !important;
            transform: translateY(-3px) !important;
        }

        .btn-proceed {
            background: rgba(55, 186, 32, 0.9) !important;
            border: 2px solid #37ba20 !important;
        }

        .btn-proceed:hover {
            background: #37ba20 !important;
            box-shadow: 0 8px 25px rgba(55, 186, 32, 0.3);
        }

        .btn-cancel {
            background: rgba(255, 71, 87, 0.9) !important;
            border: 2px solid #ff4757 !important;
        }

        .btn-cancel:hover {
            background: #ff4757 !important;
            box-shadow: 0 8px 25px rgba(255, 71, 87, 0.3);
        }

        /* Pause button - Yellow */
        .btn-warning {
            background: rgba(255, 193, 7, 0.9) !important;
            border: 2px solid #ffc107 !important;
            color: white !important;
        }

        .btn-warning:hover {
            background: #ffc107 !important;
            box-shadow: 0 8px 25px rgba(255, 193, 7, 0.4) !important;
            color: white !important;
        }

        /* Resume button - Red */
        .btn-success {
            background: rgba(220, 53, 69, 0.9) !important;
            border: 2px solid #dc3545 !important;
            color: white !important;
        }

        .btn-success:hover {
            background: #dc3545 !important;
            box-shadow: 0 8px 25px rgba(220, 53, 69, 0.4) !important;
            color: white !important;
        }

        .dropdown-menu {
            background: rgba(30, 30, 30, 0.95) !important;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1) !important;
            border-radius: 12px;
        }

        .dropdown-item {
            color: #f0f0f0 !important;
        }

        .dropdown-item:hover {
            background: rgba(102, 126, 234, 0.2) !important;
            color: #ffffff !important;
        }

        .captured-images{
            margin-left: 40px;
        }

        .placeholder {
            background: rgba(50, 50, 50, 0.8) !important;
            border: 2px dashed rgba(255, 255, 255, 0.2) !important;
            color: #b0b0b0 !important;
            border-radius: 12px;
            transition: all 0.3s ease;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 24px;
            aspect-ratio: 4 / 3 !important;
            width: 250px !important;
            height: auto !important;
        }

        .captured-images img {
    
            aspect-ratio: 4 / 3 !important;
            width: 250px !important;
            height: auto !important;
            object-fit: cover !important;
            border-radius: 12px !important;
            border: 2px solid rgba(255, 255, 255, 0.2) !important;
        }

        /* Stories format specific styling */
        body[data-format="new"] .placeholder,
        .stories-format .placeholder {
            /* You can manually adjust these values */
            aspect-ratio: 4 / 2.5 !important;
            width: 300px !important;
            height: auto !important;
        }

        body[data-format="new"] .captured-images img,
        .stories-format .captured-images img {
            /* You can manually adjust these values */
             aspect-ratio: 4 / 2.5 !important;
            width: 300px !important;
            height: auto !important;
            object-fit: cover !important;
            border-radius: 12px !important;
            border: 2px solid rgba(255, 255, 255, 0.2) !important;
        }

        /* Enhanced format preview sizing - scale down 2773x3240 ratio */
        .enhanced-only {
            aspect-ratio: 2773 / 3240 !important;
            max-height: 120px !important;
        }

        /* Enhanced format elements - consolidated rule */
        body[data-format="enhanced"] .placeholder,
        body[data-format="enhanced"] .captured-thumbnail,
        body[data-format="enhanced"] .captured-images img,
        .enhanced-format .placeholder,
        .enhanced-format .captured-thumbnail,
        .enhanced-format .captured-images img {
            aspect-ratio: 2773 / 3240 !important;
            width: 205px !important;
            height: auto !important;
            max-height: none !important;
            min-height: 120px !important;
            border-radius: 8px !important;
            box-sizing: border-box !important;
            flex-shrink: 0 !important;
        }

        /* Enhanced format specific styling for captured images */
        body[data-format="enhanced"] .captured-thumbnail,
        body[data-format="enhanced"] .captured-images img,
        .enhanced-format .captured-thumbnail,
        .enhanced-format .captured-images img {
            object-fit: cover !important;
            border: 2px solid rgba(255, 255, 255, 0.2) !important;
        }

        /* Enhanced format specific styling for placeholders */
        body[data-format="enhanced"] .placeholder,
        .enhanced-format .placeholder {
            font-size: 20px !important;
            max-width: 205px !important;
        }

        /* Enhanced format 2-column layout for preview */
        .enhanced-format .captured-images {
            display: grid !important;
            grid-template-columns: 1fr 1fr !important;
            grid-template-rows: auto auto !important;
            gap: 18px !important;
            height: auto !important;
            max-width: none !important;
            align-items: start !important;
            justify-items: center !important;
        }

        /* Enhanced format side rectangles within video preview */
        body[data-format="enhanced"] .preview::before,
        body[data-format="enhanced"] .preview::after {
            content: '';
            position: absolute;
            top: 0;
            width: 198px;
            height: 100%;
            background: rgba(0, 0, 0, 0.805);
            backdrop-filter: blur(10px);

            z-index: 5;
            pointer-events: none;
        }

        body[data-format="enhanced"] .preview::before {
            left: 0;
        }

        body[data-format="enhanced"] .preview::after {
            right: 0;
        }

        /* Enhanced format column layout adjustments */
        body[data-format="enhanced"] #cameraColumn {
            flex: 0 0 65% !important;
            max-width: 65% !important;
        }

        body[data-format="enhanced"] #previewColumn {
            flex: 0 0 35% !important;
            max-width: 35% !important;
            display: flex !important;
            flex-direction: column !important;
            align-items: start !important;
            height: auto !important;
            padding: 5px !important;
            box-sizing: border-box !important;
            overflow: visible !important;
        }

        body[data-format="enhanced"] #capturedImages {
            margin-top: 40px !important;
            height: auto !important;
            max-height: none !important;
            justify-content: center !important;
            padding: 5px !important;
            box-sizing: border-box !important;
            overflow: visible !important;
        }

        /* Timer slider styling */
        .timer-slider-wrapper {
            background: rgba(21, 21, 21, 0.671) !important;
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.1) !important;
        }

        .slider-labels span {
            color: #b0b0b0 !important;
        }

        #timerSlider {
            background: rgba(255, 255, 255, 0.1) !important;
        }

        #timerSlider::-webkit-slider-thumb {
            background: #ffb908 !important;
        }

        #timerSlider::-moz-range-thumb {
            background: #ffb908 !important;
        }

        /* Grid toggle button */
        .grid-toggle-btn {
            background: rgba(50, 50, 50, 0.9) !important;
            color: #f0f0f0 !important;
            border: 1px solid rgba(255, 255, 255, 0.1) !important;
        }

        .grid-toggle-btn:hover {
            background: rgba(70, 70, 70, 1) !important;
        }

        /* Enhanced template overlay for showing new template aspect ratio */
        .enhanced-template-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: auto;
            height: 100%; 
            aspect-ratio: 2773 / 3240;
            border: 2px solid rgba(255, 255, 255, 0.79);
            background: rgba(255, 255, 255, 0);
            pointer-events: none;
            z-index: 10;
            box-shadow: 
                inset 0 0 20px rgba(224, 224, 224, 0.2),
                0 0 20px rgba(236, 236, 236, 0.3);
        }


        /* Modal dark mode styling */
        .modal-content {
            background: rgba(30, 30, 30, 0.95) !important;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1) !important;
            color: #f0f0f0;
        }

        .modal-header {
            border-bottom: 1px solid rgba(255, 255, 255, 0.1) !important;
            background: rgba(50, 50, 50, 0.1);
        }

        .modal-title {
            color: #f0f0f0 !important;
        }

        .modal-body {
            color: #f0f0f0;
        }

        .modal-footer {
            border-top: 1px solid rgba(255, 255, 255, 0.1) !important;
            background: rgba(50, 50, 50, 0.1);
        }

        .form-check-label {
            color: #f0f0f0 !important;
        }

        .form-check-input {
            background-color: #555 !important;
            border-color: rgba(255, 255, 255, 0.2) !important;
        }

        .form-check-input:checked {
            background-color: #37ba20 !important;
            border-color: #37ba20 !important;
        }

        .btn-close {
            filter: invert(1) !important;
        }

        /* Logout button specific styling */
        #logoutButton {
            background: rgba(255, 71, 87, 0.9) !important;
            color: white !important;
            border: 2px solid #ff4757 !important;
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        #logoutButton:hover {
            background: #ff4757 !important;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 71, 87, 0.4);
        }

        /* Transparent buttons - consolidated styling */
        .action-tabs,
        .timer-container,
        .action-tabs .btn,
        .timer-container .btn,
        #timerButton,
        .dropdown .btn {
            background: transparent !important;
            border: none !important;
        }

        .action-tabs .btn,
        .timer-container .btn,
        .dropdown .btn {
            padding: 10px !important;
            border-radius: 8px !important;
        }

        .action-tabs .btn:hover,
        .timer-container .btn:hover,
        #timerButton:hover,
        .dropdown .btn:hover {
            background: transparent !important;
        }

        .dropdown .btn {
            color: #f0f0f0 !important;
            display: flex !important;
            align-items: center !important;
            gap: 8px !important;
        }

        /* SVG icons styling */
        .icon {
            fill: white !important;
            stroke: white !important;
            width: 20px;
            height: 20px;
        }

        .icon-camera {
            fill: none !important;
            stroke: white !important;
            stroke-width: 1.5 !important;
        }

        .icon-timer {
            fill: white !important;
            stroke: white !important;
        }

        .icon-grid {
            fill: currentColor !important;
            stroke: currentColor !important;
        }

        .grid-toggle-btn .icon {
            fill: #f0f0f0 !important;
            stroke: #f0f0f0 !important;
        }
    </style>

    <script src="script.js" defer></script>
</head>
<body>
    <div class="background-container" style="display: none;">
        <img src="bg.png" class="bg" alt="Background Image">
        <div class="elipse"></div>
        <svg class="border bottom-left" fill="currentColor">
            <use xlink:href="icons.svg#wave-1"></use>
        </svg>
        <svg class="border upper-right" fill="currentColor">
            <use xlink:href="icons.svg#wave-2"></use>
        </svg>
    </div>

    <!-- Back Button -->
    <button id="backButton" onclick="goBackToSelection()">←</button>

    <div class="container d-flex justify-content-center align-items-center vh-100">
        <div class="row w-100">
            <h1 class="title text-start d-flex align-items-center">
                PhotoBooth UE-SCpES
                <span id="formatIndicator" class="format-indicator">Loading...</span>
            </h1>
            <div class="col-md-8" id="cameraColumn">


                <!-- Camera Options -->
                <div class="action-tabs text-center d-flex justify-content-between align-items-center">
                    <div class="dropdown">
                        <button class="btn btn-custom dropdown-toggle d-flex align-items-center gap-2" type="button" id="cameraDropdown" data-bs-toggle="dropdown">
                            <svg class="icon icon-camera" fill="currentColor">
                                <use xlink:href="icons.svg#icon-camera"></use>
                            </svg>
                            Select Camera
                        </button>
                        <ul class="dropdown-menu" id="cameraList"></ul>
                    </div>
                
                    <div class="d-flex gap-1">
                        <!-- Timer with Slide Bar -->
                        <div class="timer-container">
                            <button id="timerButton" class="btn" onclick="toggleTimerSlider()">
                                <svg class="icon icon-timer" fill="currentColor">
                                    <use xlink:href="icons.svg#icon-timer"></use>
                                </svg>
                            </button>
                            <div id="timerSliderWrapper" class="timer-slider-wrapper">
                                <input type="range" id="timerSlider" min="1" max="3" step="1" value="2">
                                <div class="slider-labels">
                                    <span>2s</span><span>5s</span><span>10s</span>
                                </div>
                            </div>
                        </div>
                        <button id="mirrorButton" class="btn" onclick="toggleMirror()">
                            <svg class="icon icon-mirror" fill="currentColor">
                                <use xlink:href="icons.svg#icon-mirror"></use>
                            </svg>
                        </button>

                        <button id="filterButton" class="btn" onclick="toggleFilter()">
                            <svg class="icon icon-filter" fill="currentColor">
                                <use xlink:href="icons.svg#icon-filter"></use>
                            </svg>
                        </button>
                    </div>
                </div>

                
                <!-- Camera Preview -->
                <div class="preview d-flex justify-content-center position-relative">
                  
                    <video id="video" autoplay class    ="w-100"></video>
                    <button id="gridToggleButton" class="grid-toggle-btn">
                        <svg class="icon icon-grid" fill="currentColor">
                            <use xlink:href="icons.svg#icon-grid"></use>
                        </svg>
                    </button>
                    
                    <div class="grid-overlay"></div>
                    <div class="enhanced-template-overlay" style="display: none;"></div>
                    <canvas id="canvas" style="display:none;"></canvas>
                    <div class="flash" id="flash"></div>
                    <div id="countdownOverlay" class="countdown-overlay"></div>
                </div>
                

                <div class="text-center mt-3 d-flex justify-content-center gap-2">
                    <button id="startButton" type="button" class="btn btn-start" onclick="startCapture()">
                        <svg class="icon icon-start" fill="currentColor">
                            <use xlink:href="icons.svg#icon-start"></use>
                        </svg>Start</button>
                    
                    <!-- Capture control buttons -->
                    <button id="pauseButton" type="button" class="btn btn-warning" style="display:none;" onclick="pauseCapture()">Pause</button>
                    <button id="cancelButton" type="button" class="btn btn-cancel" style="display:none;" onclick="cancelCapture()">Cancel</button>
                    
                    <!-- Paused state buttons -->
                    <button id="resumeButton" type="button" class="btn btn-success" style="display:none;" onclick="resumeCapture()">Resume</button>
                    <button id="resetButton" type="button" class="btn btn-secondary" style="display:none;" onclick="resetCapture()">
                        <svg class="icon icon-reset" fill="currentColor">
                            <use xlink:href="icons.svg#icon-reset"></use>
                        </svg>Reset</button>
                    
                    <!-- Completion buttons -->
                    <button id="retakeButton" type="button" class="btn btn-warning" style="display:none;" onclick="resetCapture()">
                        <svg class="icon icon-reset" fill="currentColor">
                            <use xlink:href="icons.svg#icon-reset"></use>
                        </svg>Retake</button>
                    <button id="proceedButton" type="button" class="btn btn-proceed" style="display:none;" onclick="proceedToTemplate()">  
                        <svg class="icon icon-start" fill="currentColor">
                            <use xlink:href="icons.svg#icon-start"></use>
                        </svg> Next
                    </button>
                </div>
                
                

            </div>

            <!-- Right: Captured Images -->
            <div class="col d-flex flex-column align-items-start" id="previewColumn">
                <div id="capturedImages" class="captured-images d-flex flex-column gap-3">
                    <div class="placeholder p-4 text-center">1</div>
                    <div class="placeholder p-4 text-center">2</div>
                    <div class="placeholder p-4 text-center">3</div>
                    <div class="placeholder p-4 text-center enhanced-only" style="display: none;">4</div>
                </div>
            </div>


        </div>
    </div>

    <audio id="shutterSound" src="shutter.mp3"></audio>
    <audio id="beepSound" src="countdown.mp3"></audio>
    <audio id="countdownHigh" src="countdown high.mp3"></audio>

    <!-- Settings Modal -->
    <div class="modal fade settings-modal " id="settingsModal" tabindex="-1" aria-labelledby="settingsModalLabel" aria-hidden="true">
        <div class="modal-dialog  modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="settingsModalLabel">Settings</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <label class="form-check-label mt-3">
                        <input type="checkbox" id="gridOverlayToggle" class="form-check-input"> Show Grid Overlay
                    </label>
                
                    
                </div>
                <button id="logoutButton">Logout</button>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary">Save Changes</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Image Preview Modal -->
    <div class="modal fade" id="imagePreviewModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                    <img id="modalImage" src="" class="img-fluid rounded" alt="Captured Image">
            </div>
        </div>
    </div>

    <script src="shared-login.js"></script>
    <script>
        // Check if format is selected, if not redirect to format selection
        document.addEventListener("DOMContentLoaded", () => {
            // Check if user is logged in first
            checkLoginStatus();
            
            const selectedFormat = localStorage.getItem("selectedFormat");
            if (!selectedFormat) {
                window.location.href = "format-selection.html";
            }
            
            // Display current format selection
            console.log("🚀 DOM loaded, calling updateFormatIndicator...");
            updateFormatIndicator();
            updateFormatSpecificUI();
            
            // Also call it after a short delay to ensure DOM is fully ready
            setTimeout(() => {
                console.log("⏰ Delayed call to updateFormatIndicator...");
                updateFormatIndicator();
                updateFormatSpecificUI();
            }, 100);
        });
        
        // Function to go back to format selection
        function goBackToSelection() {
            window.location.href = "format-selection.html";
        }
        
        // Function to update format indicator
        function updateFormatIndicator() {
            let selectedFormat = localStorage.getItem("selectedFormat");
            const indicator = document.getElementById("formatIndicator");
            
            console.log("🔍 Updating format indicator:", selectedFormat);
            console.log("🔍 Indicator element:", indicator);
            
            if (!indicator) {
                console.error("❌ Format indicator element not found!");
                return;
            }
            
            // Set default format if none is selected
            if (!selectedFormat) {
                selectedFormat = "new"; // Default to Stories & Social
                localStorage.setItem("selectedFormat", selectedFormat);
                console.log("🔧 No format selected, setting default to Stories & Social");
            }
            
            // Clear any existing classes
            indicator.classList.remove("classic", "stories", "enhanced");
            
            // Set the text content and class
            if (selectedFormat === "old") {
                indicator.textContent = "Classic Portrait";
                indicator.innerHTML = "Classic Portrait"; // Also set innerHTML
                indicator.classList.add("classic");
                console.log("✅ Format indicator set to Classic Portrait");
            } else if (selectedFormat === "enhanced") {
                indicator.textContent = "Photostrip v2";
                indicator.innerHTML = "Photostrip v2"; // Also set innerHTML
                indicator.classList.add("enhanced");
                console.log("✅ Format indicator set to Enhanced Portrait");
            } else {
                indicator.textContent = "Stories & Social";
                indicator.innerHTML = "Stories & Social"; // Also set innerHTML
                indicator.classList.add("stories");
                console.log("✅ Format indicator set to Stories & Social");
            }
            
            // Force visibility with multiple approaches
            indicator.style.display = "inline-block";
            indicator.style.visibility = "visible";
            indicator.style.opacity = "1";
            indicator.style.color = "white";
            indicator.style.fontSize = "12px";
            indicator.style.fontWeight = "600";
            indicator.style.textAlign = "center";
            indicator.style.lineHeight = "1.2";
            
            // Force a reflow to ensure styles are applied
            indicator.offsetHeight;
            
            console.log("🔍 Final indicator text:", indicator.textContent);
            console.log("🔍 Final indicator innerHTML:", indicator.innerHTML);
            console.log("🔍 Final indicator classes:", indicator.className);
            console.log("🔍 Final indicator computed styles:", window.getComputedStyle(indicator).color);
        }

        // Function to update format-specific UI elements
        function updateFormatSpecificUI() {
            const selectedFormat = localStorage.getItem("selectedFormat");
            const fourthSlot = document.querySelector('.enhanced-only');
            const enhancedOverlay = document.querySelector('.enhanced-template-overlay');
            const capturedImagesContainer = document.getElementById('capturedImages');
            const parentCol = capturedImagesContainer.parentElement;
            
            console.log("🔧 Updating format-specific UI for:", selectedFormat);
            
            // Set body data attribute for CSS targeting
            document.body.setAttribute('data-format', selectedFormat);
            
            if (selectedFormat === "enhanced") {
                // Show 4th slot for enhanced format
                if (fourthSlot) {
                    fourthSlot.style.display = "flex";
                    console.log("✅ Showing 4th photo slot for enhanced format");
                }
                
                // Show enhanced template overlay
                if (enhancedOverlay) {
                    enhancedOverlay.style.display = "block";
                    console.log("✅ Showing enhanced template overlay");
                }
                
                // Apply enhanced format layout
                if (parentCol) {
                    parentCol.classList.add('enhanced-format');
                    console.log("✅ Applied enhanced format 2-column layout");
                }
                
                // Force aspect ratio on all placeholders immediately
                const allPlaceholders = document.querySelectorAll('.placeholder');
                allPlaceholders.forEach(placeholder => {
                    placeholder.style.aspectRatio = '2773 / 3240';
                });
                console.log("✅ Forced 2773:3240 aspect ratio on all placeholders");
                
            } else {
                // Hide 4th slot for other formats
                if (fourthSlot) {
                    fourthSlot.style.display = "none";
                    console.log("🔒 Hiding 4th photo slot for non-enhanced format");
                }
                
                // Hide enhanced template overlay
                if (enhancedOverlay) {
                    enhancedOverlay.style.display = "none";
                    console.log("🔒 Hiding enhanced template overlay");
                }
                
                // Remove enhanced format layout
                if (parentCol) {
                    parentCol.classList.remove('enhanced-format');
                    console.log("🔒 Removed enhanced format layout");
                }
                
                // Reset aspect ratio on all placeholders
                const allPlaceholders = document.querySelectorAll('.placeholder');
                allPlaceholders.forEach(placeholder => {
                    placeholder.style.aspectRatio = '400/ 300';
                });
                console.log("🔒 Reset placeholders to 4:3 aspect ratio");
            }
        }

        // Debug function to test format indicator
        window.testFormatIndicator = function() {
            console.log("🧪 Testing format indicator...");
            updateFormatIndicator();
        };

        // Debug function to set format for testing
        window.setFormat = function(format) {
            console.log("🔧 Setting format to:", format);
            localStorage.setItem("selectedFormat", format);
            updateFormatIndicator();
        };

        // Debug function to force show text
        window.forceShowText = function() {
            const indicator = document.getElementById("formatIndicator");
            if (indicator) {
                indicator.textContent = "TEST TEXT";
                indicator.innerHTML = "TEST TEXT";
                indicator.style.color = "white";
                indicator.style.fontSize = "14px";
                indicator.style.fontWeight = "bold";
                console.log("🔧 Forced text display");
            }
        };

        // Try to update format indicator immediately
        console.log("🚀 Script loaded, attempting immediate format update...");
        setTimeout(() => {
            updateFormatIndicator();
            updateFormatSpecificUI();
        }, 50);
    </script>

</body>
</html>
